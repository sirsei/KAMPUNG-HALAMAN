--// SERVICES
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualUser = game:GetService("VirtualUser")
local VIM = game:GetService("VirtualInputManager")

--// SETTINGS
local AUTO = false
local AUTO_SELL_ENABLED = false
local AUTO_SELL_DELAY = 5
local INPUT_DELAY = 1.8
local ANTI_AFK = true

local selectedRarities = {}
local RodList = {}
local RodIndex = 1

--// DATA
local AvailableRods = {
    "Pancingan Bambu","Pancingan Jamur","Pancingan Panas","Pancingan Trisula",
    "Pancingan Kristal","Pancingan Petir Hitam","Pancingan Gitar","Pancingan Unyu",
    "Pancingan Dingin","Pancingan Corrupt","Pancingan Kuil","Pancingan Dewa",
    "Pancingan Sabit","Pancingan Ubur Ubur","Pancingan Kuncen","Pancingan Parasol",
    "Pancingan Galaksi","Pancingan Ksatria","Pancingan Kegelapan","Pancingan Volcano",
    "Pancingan Karuhun","Pancingan Executive"
}

local rarities = {
    "Common","UnCommon","Rare","Epic","Legendary","Mythical","Unknown"
}

--// FUNCTIONS
local function findRod(name)
    if Player.Character and Player.Character:FindFirstChild(name) then
        return Player.Character[name]
    end
    if Player.Backpack:FindFirstChild(name) then
        return Player.Backpack[name]
    end
end

--// ANTI AFK
Player.Idled:Connect(function()
    if ANTI_AFK then
        VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        task.wait(1)
        VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    end
end)

--// UI LOAD
local DarkraiX = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/GamingScripter/Kavo-Ui/main/Darkrai%20Ui", true))()

local Library = DarkraiX:Window(
    "SeiX", "ðŸ˜œ", "", Enum.KeyCode.RightControl
)

--// SIMPLE OPEN BUTTON (RAINBOW BORDER)
local openGui = Instance.new("ScreenGui", Player.PlayerGui)
openGui.ResetOnSpawn = false

local openBtn = Instance.new("TextButton", openGui)
openBtn.Size = UDim2.fromOffset(70, 32)
openBtn.Position = UDim2.new(0, 15, 0.5, -16)
openBtn.BackgroundColor3 = Color3.fromRGB(18,18,18)
openBtn.Text = "OPEN"
openBtn.Font = Enum.Font.GothamBold
openBtn.TextSize = 13
openBtn.TextColor3 = Color3.fromRGB(240,240,240)
openBtn.BorderSizePixel = 0
openBtn.AutoButtonColor = false
openBtn.Active = true
openBtn.Draggable = true

Instance.new("UICorner", openBtn).CornerRadius = UDim.new(0,6)

local stroke = Instance.new("UIStroke", openBtn)
stroke.Thickness = 2
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

task.spawn(function()
    local h = 0
    while task.wait(0.03) do
        h = (h + 0.005) % 1
        stroke.Color = Color3.fromHSV(h,1,1)
    end
end)

openBtn.MouseButton1Click:Connect(function()
    VIM:SendKeyEvent(true, Enum.KeyCode.RightControl, false, game)
    VIM:SendKeyEvent(false, Enum.KeyCode.RightControl, false, game)
end)

--// TAB 1 : MAIN FISHING
local Tab1 = Library:Tab("Main Fishing")

Tab1:Toggle("Start Auto Fishing", false, function(v)
    AUTO = v
end)

Tab1:Slider("Delay (Detik)", 1, 10, 2, function(v)
    INPUT_DELAY = v
end)

Tab1:Dropdown("Select Rod Loop", AvailableRods, function(r)
    local i = table.find(RodList, r)
    if i then
        table.remove(RodList, i)
    else
        table.insert(RodList, r)
    end
end)

Tab1:Toggle("Anti-AFK", true, function(v)
    ANTI_AFK = v
end)

--// TAB 2 : AUTO SELL
local Tab2 = Library:Tab("Auto Sell")

Tab2:Toggle("Enable Auto Sell", false, function(v)
    AUTO_SELL_ENABLED = v
end)

Tab2:Textbox("Sell Delay (Seconds)", "5", true, function(v)
    local n = tonumber(v)
    if n and n >= 0.5 then
        AUTO_SELL_DELAY = n
    end
end)

Tab2:Seperator("Auto Sell Rarity")

for _, r in ipairs(rarities) do
    Tab2:Toggle("Auto Sell "..r, false, function(v)
        selectedRarities[r] = v
    end)
end

-- ðŸ”¥ MANUAL SELL (1 CLICK)
Tab2:Seperator("Sell Once (Manual)")

for _, r in ipairs(rarities) do
    Tab2:Button("Sell "..r.." (1x)", function()
        ReplicatedStorage:WaitForChild("RequestSell"):FireServer(r)
    end)
end

--// LOOP : AUTO SELL
task.spawn(function()
    local timer = 0
    while task.wait(0.5) do
        if AUTO_SELL_ENABLED then
            timer += 0.5
            if timer >= AUTO_SELL_DELAY then
                for rarity, enabled in pairs(selectedRarities) do
                    if enabled then
                        ReplicatedStorage.RequestSell:FireServer(rarity)
                    end
                end
                timer = 0
            end
        else
            timer = 0
        end
    end
end)

--// LOOP : FISHING
task.spawn(function()
    while task.wait(0.1) do
        if AUTO and #RodList > 0 then
            local rodName = RodList[RodIndex]
            local rod = findRod(rodName)

            if rod then
                if rod.Parent ~= Player.Character then
                    Player.Character.Humanoid:EquipTool(rod)
                    task.wait(0.2)
                end

                pcall(function()
                    rod.Mechanics.Remotes.CastEvent:FireServer(false, 7)

                    local root = Player.Character:FindFirstChild("HumanoidRootPart")
                    if root then
                        ReplicatedStorage.Remotes.BaitLandedEvent:FireServer(
                            rod,
                            root.Position + (root.CFrame.LookVector * 15),
                            "TerrainWater"
                        )
                    end

                    task.wait(INPUT_DELAY)
                    rod.Mechanics.Remotes.MiniGame:FireServer(true)
                    task.wait(0.1)
                    rod.Mechanics.Remotes.MiniGame:FireServer(false)
                end)
            end

            RodIndex = (RodIndex % #RodList) + 1
        end
    end
end)
